---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

```{r echo=FALSE, results='hide', warning=FALSE}
options(width=120)
library(sqldf)
library(lattice)
```

```{r}
temp <- tempfile()
download.file("http://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip", temp)
#download.file("http://github.com/rsamban/RepData_PeerAssessment1/blob/master/activity.zip", temp)
allData <- read.csv(unz(temp,"activity.csv"), sep=",")
unlink(temp)
allData$date <- as.Date(allData$date, "%Y-%m-%d")
```

## What is mean total number of steps taken per day?
**1.Average total Number Of Steps per day**
```{r}
allCompleteData <- allData[complete.cases(allData),]
stepsByDate <- aggregate(steps~date, allCompleteData, sum, na.rm=TRUE)
mean(stepsByDate$steps);median(stepsByDate$steps)
```

**1. Histogram of Toal number of Steps per Day**
```{r}
hist(stepsByDate$steps, xlab="Total No. Of Steps", ylab="Days", main="2. Histogram of Steps By Day")
```

## What is the average daily activity pattern?

```{r}
avgActivityInMinutesInterval <- aggregate(steps~interval, allData, mean)
plot(avgActivityInMinutesInterval$interval, avgActivityInMinutesInterval$steps, type="l", xlab="Time Of Day", ylab="Average Number of Steps", main="1. Daily Activity Pattern")
```

**2. Following 5 minute interval has maximum number of steps on average**
```{r}
avgActivityInMinutesInterval[avgActivityInMinutesInterval$steps==max(avgActivityInMinutesInterval$steps),]$interval
```
## Imputing missing values

**Following are the number of rows that have NAs**
```{r}
nrow(allData[is.na(allData$steps),])
```

**Following code fills in the NAs with average values for the interval calculated over all dates.**
```{r}
meanStepsInInterval <- aggregate(steps~interval, allCompleteData, mean)
allDataFilled <- sqldf(c("update allData set steps=(select steps from meanStepsInInterval a where a.interval=allData.interval) where steps is null", "select * from allData"))
```

**1. As can be seen from the histograms below, the mean value of number of steps taken when value is missing for the interval is same for all missing intervals. This implies that values are missing for all full day.**

```{r}
filledStepsByDate <- aggregate(steps~date, allDataFilled, sum)
par(mfcol=c(1,2))
hist(filledStepsByDate$steps, xlab="Total No. Of Steps", ylab="Days", main="NAs filled by average for the interval")
hist(stepsByDate$steps, xlab="Total No. Of Steps", ylab="Days", main="NAs removed")
```

**1.Average total Number Of Steps per day after filling NAs with average steps for the interval of all the days**
```{r}
mean(filledStepsByDate$steps);median(filledStepsByDate$steps);
```

**Observations**  
As can be seen from above the imputing missing values does not affect the average total number of daily steps.

## Are there differences in activity patterns between weekdays and weekends?

```{r}
weekends <- c("Saturday","Sunday")
allDataFilled$isWeekend <- factor(weekdays(allDataFilled$date) %in% weekends, levels=c(TRUE,FALSE), labels=c("weekend","weekday"))
xyplot(steps~interval | isWeekend, index.cond=list(c(2,1)), data=allDataFilled, layout=c(1,2), xlab="Interval", ylab="Number Of Steps", type="l")
```